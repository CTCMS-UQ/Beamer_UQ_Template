%%------------------------------------------------------------%%
% File created: 10 Dec 2021
%
% Beamer theme for the University of Queensland.
% Created by S. Tee, adapted by S. Sanderson
%%------------------------------------------------------------%%

\usetheme[progressbar=frametitle]{metropolis}
\usepackage{textpos}

% Colour defines
\usepackage{xcolor}
\definecolor{uqviolet}{RGB}{81,36,122}
\definecolor{uqmagenta}{RGB}{150,42,139}
\definecolor{uqorange}{RGB}{235,96,43}

% Colour Theme
\setbeamercolor*{structure}{bg=uqviolet!20,fg=uqviolet}

\setbeamercolor*{palette primary}{use=structure,fg=white,bg=structure.fg}
\setbeamercolor*{palette secondary}{use=structure,fg=white,bg=structure.fg!75}
\setbeamercolor*{palette tertiary}{use=structure,fg=white,bg=structure.fg!50!black}
\setbeamercolor*{palette quaternary}{fg=white,bg=black}

\colorlet{titleleft}{uqmagenta}
\colorlet{titlemiddle}{uqmagenta!50!uqviolet}
\colorlet{titleright}{uqviolet}

\makeatletter
\pgfdeclarehorizontalshading[titleleft,titlemiddle,titleright]
      {beamer@frametitleshade}{\paperheight}{
    color(0pt)=(titleleft);
    color(0.2\paperwidth)=(titlemiddle);
    color(0.65\paperwidth)=(titleright);
    color(\paperwidth)=(titleright)
  }
\makeatother

% Header
%%custom header start
\makeatletter
\defbeamertemplate*{frametitle}{horizontal shading}
{%
  \nointerlineskip%
  %\vskip+3pt%
  \hbox{\leavevmode
    \advance\beamer@leftmargin by -12bp%
    \advance\beamer@rightmargin by -12bp%
    \beamer@tempdim=\textwidth%
    \advance\beamer@tempdim by \beamer@leftmargin%
    \advance\beamer@tempdim by \beamer@rightmargin%
    \hskip-\Gm@lmargin\hbox{%
      \setbox\beamer@tempbox=\hbox{\begin{minipage}[b]{\paperwidth}%
          \vbox{}\vskip-1ex%
          \leftskip0.3cm%
          \hskip1em
          \rightskip0.3cm plus1fil\leavevmode
          \insertframetitle%
          \ifx\insertframesubtitle\@empty%
            \strut\par%
          \else
            \par{\usebeamerfont*{framesubtitle}{\usebeamercolor[fg]{framesubtitle}\insertframesubtitle}\strut\par}%
          \fi%
          \nointerlineskip
          \vbox to .8ex{}%
          \end{minipage}}%
      \beamer@tempdim=\ht\beamer@tempbox%
      \advance\beamer@tempdim by 8pt%
      \begin{pgfpicture}{0pt}{0pt}{\paperwidth}{\beamer@tempdim}
        \usebeamercolor{titleright}
        \pgfpathrectangle{\pgfpointorigin}{\pgfpoint{\paperwidth}{\beamer@tempdim}}
        \pgfusepath{clip}
        \pgftext[left,base]{\pgfuseshading{beamer@frametitleshade}}
        %\pgfputat{\pgfxy(1,1)}{\pgfbox[left,base]{\pgfuseimage{logo}}}
      \end{pgfpicture}
      \hskip-\paperwidth%
      \box\beamer@tempbox%
    }%
    \hskip-\Gm@rmargin%
  }%
    %\vskip-2pt
}
\makeatother
%%custom header end

% Logo
\addtobeamertemplate{frametitle}{}{%
\begin{textblock*}{100mm}(.78\textwidth,-.97cm)
\includegraphics[height=.96cm]{UQlogo}
\end{textblock*}}

% Fonts
\usefonttheme{professionalfonts} % using non standard fonts for beamer
\usefonttheme{serif} % default family is serif
\usepackage{fontspec}
\setmainfont{Liberation Serif}
